<!DOCTYPE html>
<html>
    <head><title>Controller UI</title></head>
    <body>
        <script>
            const jsonEvtHandlers = {
                button:json=>console.log("button", json),
                config:json=>console.log("config", json),
                panick:json=>console.log("panick", json),
            }

            ws = new WebSocket("ws://"+location.hostname+":9005");
            ws.addEventListener("open", evt=>{
                console.log("Connected to tGem", evt);
                ws.send(JSON.stringify(["button", "config", "panick"]));
            });
            ws.addEventListener("message", evt=>{
                // Grab the JSON - if it doesn't exist, or if there isn't a function for it, print the contents
                try{
                    const data = JSON.parse(evt.data);
                    if(jsonEvtHandlers[data.event]) jsonEvtHandlers[data.event](data);
                    else console.log("tGem -", data);
                }
                catch(e){
                    console.error("Something crashed!", e);
                }
            });

            document.addEventListener("close", ()=>ws.close())
        </script>
    </body>
</html>